<div
  class="content-box"
  style="max-width: 1126px; margin: 0px -12px; padding: 0 12px"
>
  <div class="grid-row">
    <div
      class="col-xs-12 col-md-12"
      style="overflow: hidden; position: relative"
    >
      <img
        class="rotate-180 opacity-half"
        style="height: 60px; vertical-align: middle"
        role="presentation"
        src="https://content.bridgepointeducation.com/curriculum/file/f881c28d-b8b7-4695-a677-bed16afbf12d/1/Shadow.png"
        alt=" "
        width="1051"
        height="60"
        data-decorative="true"
      />
      <div class="header-bar color2-gradient" style="padding: 35px 40px 30px">
        <h1>Block 32: API Routes</h1>
      </div>
      <div
        class="mobile-hide"
        style="position: absolute; top: 30px; margin: 0 45px"
      >
        <div
          class="accent-header color1-gradient letter-spaced uppercase"
          style="padding: 5px 30px 5px; background: #fff"
        >
          <h2>Unit 4</h2>
        </div>
        <img
          class=""
          style="width: 0; min-width: 100%; height: 40px"
          role="presentation"
          src="https://content.bridgepointeducation.com/curriculum/file/f881c28d-b8b7-4695-a677-bed16afbf12d/1/Shadow.png"
          alt=" "
          width="177"
          height="40"
          data-decorative="true"
        />
      </div>
      <div>
        <div style="padding: 0 0 20px">
          <img
            class=""
            style="height: 40px; width: 100%"
            role="presentation"
            src="https://content.bridgepointeducation.com/curriculum/file/f881c28d-b8b7-4695-a677-bed16afbf12d/1/Shadow.png"
            alt=" "
            width="1051"
            height="40"
            data-decorative="true"
          /><span
            style="
              font-family: inherit;
              font-size: 1.8em;
              color: var(--ic-brand-font-color-dark);
            "
            >Learning Teams: Connecting</span
          >
        </div>
      </div>
    </div>
  </div>
</div>
<h3>Discussion Prompt</h3>
<p>As a team, discuss the following prompt:</p>
<p>
  <em
    ><span
      >How does Express.js make routing with JavaScript easier than using
      Vanilla JS?</span
    ></em
  >
</p>
<p>
  <em
    ><span
      >How are we doing on our team goals? Review them in
      <a
        title="Unit 1 Goals"
        href="https://fullstack.instructure.com/courses/525/discussion_topics/806"
        data-api-endpoint="https://fullstack.instructure.com/api/v1/courses/525/discussion_topics/806"
        data-api-returntype="Discussion"
        >this discussion thread</a
      >.&nbsp;</span
    ></em
  >
</p>
<hr />
<h2 id="overview">Lesson Overview</h2>
<p>
  In this lesson, we will learn about backend fundamentals in a Node.js
  environment using our JavaScript skills.
</p>
<h3 id="creatingawebsite">Learning Objectives</h3>
<ol>
  <li aria-level="1">
    Use Express router and modules to create various functioning REST API
    endpoints
  </li>
  <li aria-level="1">
    Apply REST API design best practices to server routing.
  </li>
  <li aria-level="1">
    Create various functioning REST endpoints with proper CRUD operations using
    `pg` and Express.js
  </li>
  <li aria-level="1">
    Explain and demonstrate how the `pg` npm package is used to connect an
    Express API server with a Postgres database
  </li>
</ol>
<p>
  There are 2<strong>&nbsp;tabs&nbsp;</strong>below. Complete the guided
  practice, and use the lesson resources tab as needed.&nbsp;
</p>
<div class="enhanceable_content tabs">
  <ul>
    <li><a href="#fragment-1"> Lesson Resources </a></li>
    <li><a href="#fragment-2">PostgreSQL Docs</a></li>
    <li><a href="#fragment-3"> Guided Practice </a></li>
  </ul>


  <div id="fragment-1">
    <h2>Lesson Resources</h2>
    <iframe
      src="https://docs.google.com/presentation/d/1avzLnZceBsosKewAhfJjAITfjOLErRiXV0AR8sPPuGE/embed?start=false&amp;loop=false&amp;delayms=3000"
      width="100%"
      height="500"
      allowfullscreen="allowfullscreen"
      webkitallowfullscreen="webkitallowfullscreen"
      mozallowfullscreen="mozallowfullscreen"
    ></iframe>
  </div>



    <div id="framgent-2">
        <h2>PostgreSQL Documentation</h2>
        <p>
        It is always a good idea to start with a basic tutorial from the
        documentation when working with a new software tool.
        </p>
        <p>
        <a
            href="https://www.postgresql.org/docs/9.5/static/tutorial.html"
            target="_blank"
            >PostgreSQL Tutorial</a
        >
        </p>
        <p>
        The documentation should be your first source of guidance and a singular
        source of truth while developing.
        </p>
        <p>
        <a
            href="https://www.postgresql.org/docs/9.5/static/index.html"
            target="_blank"
            >PostgreSQL Documentation</a
        >
        </p>
        <p>
        When you are ready to start writing SQL queries, the documentation is a
        great place to start. PostgreSQL commands are different than other
        providers like MySQL or SQL Server.
        </p>
        <p>
        <a
            href="https://www.postgresql.org/docs/9.5/static/sql-commands.html"
            target="_blank"
            >PostgreSQL SQL Commands</a
        >
        </p>
    </div>

  <div id="fragment-3">
    <h2>Guided Practice</h2>
    <p>Begin with our database:</p>
    <ol style="list-style-type: decimal">
      <li>
        Check for `psql` in your terminal. If it is not installed, install it.
        <details>
          <summary>Show Answer</summary>
          <pre><code>
$ psql -version
            </code></pre>
          </code></pre>
        </details>
      </li>
      <li>
        Log into `psql` with your username.
        
        <details>
          <summary>Show Answer</summary>
          <pre><code>
  $ psql -U postgres
            </code></pre>
        </details>
      </li>
      <li>
        Create a new database called `vetclinic`.
        <details>
          <summary>Show Answer</summary>
          <pre><code>
CREATE DATABASE vetclinic;
            </code></pre>
        </details>
      </li>
    </ol>
    <p>Now, lets work with the API.</p>
    <ol style="list-style-type: decimal">
      <li>
        Clone the repo from GitHub and install the dependencies.
        <details>
          <summary>Show Answer</summary>
          <pre><code>
$ npm install
            </code></pre>
        </details>
      </li>
      <li>We need to seed our database with some initial data. Open your `package.json` file to find the script to seed.
        <details>
          <summary>Show Answer</summary>
          <pre><code>
"scripts": {
    "seed": "node ./db/seeds.js"
    },
                </code></pre>
            </details>
      </li>
        <li>
            Run the seed script.
            <details>
            <summary>Show Answer</summary>
            <pre><code>
$ npm run seed
            </code></pre>
            </details>
        </li>
        <li>Uh oh. We got an error after "Creating Initial Appointments..." What should we do?
            <details>
            <summary>Show Answer</summary>
            <pre><code>
// We need to correct the dogs table and the "ages" value to be named "age"
CREATE TABLE dogs(
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    breed VARCHAR(255) NOT NULL,
    age INTEGER NOT NULL, ## This should be age, not ages
    weight INTEGER NOT NULL,
    owner VARCHAR(255) NOT NULL,
    checked_in BOOLEAN DEFAULT false
);
// Run the seed script again
            </code></pre>
            </details>
        </li>
        <li>
            Start the server. The development script can be found in the `package.json` file.
            <details>
            <summary>Show Answer</summary>
            <pre><code>
$ npm run start:dev
            </code></pre>
            </details>
        </li>
        <li>
            Open the browser and navigate to `localhost:8080/api/cats`. There's an error! What should we do?
            <details>
            <summary>Show Answer</summary>
            <pre><code>
// In the './db/cats.js' file, we need to write an async database query to select all entries from the cats table.
async function getAllCats(){
    try {
        const {rows} = await client.query(`
            SELECT * FROM cats;
        `);
        return rows;
    } catch (error) {
        throw error;
    }
}
// In the './api/cats.js' file, we need to call the getAllCats function and await the response.
router.get('/', async (req, res, next) => {
    try {
        const cats = await getAllCats();
        res.send(cats);
    } catch (error) {
        next(error);
    }
});
            </code></pre>
            </details>
        </li>
        <li>
            Time to use Postman to test a POST request. Open Postman and create a new request at `localhost:8080/api/cats`. We have another error! What should we do?
            <details>
            <summary>Show Answer</summary>
            <pre><code>
// In the './api/cats.js' file, we need to call the createCat function and await the response.
const { getAllCats, getCatById, createCat, updateCat, deleteCat } = require('../db');
            </code></pre>
            </details>
        </li>
        <li>
            Now that we have our POST request working, we can test our GET request. How should your test look?
            <details>
            <summary>Show Answer</summary>
            <p>An example - your values may differ, but the keys should be the same.</p>
            <pre><code>
{
    "name": "Mittens",
    "breed": "Tabby",
    "age": 2,
    "weight": 10,
    "owner": "John Smith",
    "checked_in": false
}
            </code></pre>
            </details>
        </li>
        <li>
            We should test our PUT request to edit data. Using Postman, update our new cat, Mittens, to be checked in.
            <details>
            <summary>Show Answer</summary>
            <p>An example - yours may differ.</p>
            <pre><code>
{
    "name": "Mittens",
    "breed": "Tabby",
    "age": 2,
    "weight": 10,
    "owner": "John Smith",
    "checked_in": true
}
            </code></pre>
            </details>
        </li>

        <li>
            We should test our DELETE request to delete data. Using Postman, delete our new cat, Mittens.
            <details>
            <summary>Show Answer</summary>
            <p>DELETE - localhost:8080/api/cats/(THE ID OF MITTENS)</p>
            </details>
        </li>
    </ol>
     
</div>

</div>
<h2><strong style="color: var(--ic-brand-font-color-dark); font-family: inherit; font-size: 1rem;">Done?</strong><span style="color: var(--ic-brand-font-color-dark); font-family: inherit; font-size: 1rem;"> Make sure you've completed both tabs above:</span></h2>
<ul>
<li><span style="color: var(--ic-brand-font-color-dark); font-family: inherit; font-size: 1rem;">Lesson Resources</span></li>
<li><span style="color: var(--ic-brand-font-color-dark); font-family: inherit; font-size: 1rem;">Guided Practice</span></li>
</ul>